models:

  - name: stg_sql_server_dbo__promos
    description: promos info
    config:
      contract: 
        enforced: true
    columns:
      - name: promo_id
        data_type: text
        constraints:
          - type: primary_key          
      - name: promo_name
        data_type: text
      - name: discount_dollar
        data_type: integer
      - name: status
        data_type: boolean
      - name: date_load_utc
        data_type: timestamp_tz        
      - name: date_deleted
        data_type: boolean

  - name: stg_sql_server_dbo__addresses
    description: addresses info
    config: 
      contract: 
        enforced: true
    columns:
      - name: address_id
        data_type: text
        constraints:
          - type: primary_key
      - name: address
        data_type: text
      - name: zipcode
        data_type: integer
      - name: state
        data_type: text
      - name: country
        data_type: text
      - name: date_load_utc
        data_type: timestamp_tz
      - name: date_deleted
        data_type: boolean
      
  - name: stg_sql_server_dbo__products
    description: info products
    config:
      contract:
        enforced: true
    columns:
      - name: product_id
        data_type: text
        constraints:
          - type: primary_key
      - name: name
        data_type: text
      - name: price
        data_type: float
      - name: inventory
        data_type: integer
      - name: date_load_utc
        data_type: timestamp_tz
      - name: date_deleted
        data_type: boolean

  - name: stg_sql_server_dbo__users
    description: users info
    config:
      contract:
        enforced: true
    columns:
      - name: user_id
        data_type: text
        constraints:
          - type: primary_key
      - name: first_name
        data_type: text
      - name: last_name
        data_type: text
      - name: phone_number
        data_type: text
      - name: email
        data_type: text
      - name: total_orders
        data_type: integer
      - name: updated_at
        data_type: timestamp_tz
      - name: created_at
        data_type: timestamp_tz
      - name: address_id
        data_type: text        
        constraints:
          - type: foreign_key
            to: ref('stg_sql_server_dbo__addresses')
            to_columns: [address_id]
        data_tests:
          - relationships:
              field: address_id
              to: ref('stg_sql_server_dbo__addresses')
      - name: date_load_utc
        data_type: timestamp_tz        
      - name: date_deleted
        data_type: boolean

  - name: stg_sql_server_dbo__shipping_service
    description: shipping service info
    config:
      contract:
        enforced: true
    constraints:
      - type: primary_key
        columns: [shipping_service_id]
    columns:
      - name: shipping_service_id
        data_type: text
      - name: shipping_service_name
        data_type: text
      - name: date_load_utc
        data_type: timestamp_tz        
      - name: date_deleted
        data_type: boolean

  - name: stg_sql_server_dbo__orders
    description: orders info
    config:
      contract:
        enforced: true
    constraints:
      - type: primary_key
        columns: [order_id]
    columns:
      - name: order_id
        data_type: text
      - name: shipping_service_id # fk de shipping_service
        data_type: text
        data_tests:
          - relationships:
              field: shipping_service_id
              to: ref('stg_sql_server_dbo__shipping_service')
        constraints:
          - type: foreign_key
            to: ref('stg_sql_server_dbo__shipping_service')
            to_columns: [shipping_service_id]
      - name: address_id # fk de addresses
        data_type: text
        data_tests:
          - relationships:
              field: address_id
              to: ref('stg_sql_server_dbo__addresses')
        constraints:
          - type: foreign_key
            to: ref('stg_sql_server_dbo__addresses')
            to_columns: [address_id]
      - name: USER_ID # fk de users
        data_type: text
        data_tests:
          - relationships:
              field: user_id
              to: ref('stg_sql_server_dbo__users')
        constraints:
          - type: foreign_key
            to: ref('stg_sql_server_dbo__users')
            to_columns: [user_id]
      - name: SHIPPING_COST
        data_type: float
      - name: CREATED_AT
        data_type: timestamp_tz
      - name: PROMO_ID
        data_type: text
      - name: ESTIMATED_DELIVERY_AT
        data_type: timestamp_tz
      - name: ORDER_COST        
        data_type: float
      - name: ORDER_TOTAL
        data_type: float
      - name: DELIVERED_AT        
        data_type: timestamp_tz
      - name: TRACKING_ID # ¿?¿?¿?
        data_type: text
      - name: STATUS # comprobar tres valores
        data_type: text
        data_tests:
          - accepted_values:
              values: ['delivered','preparing','shipped'] # poner en otra tabla
      - name: date_load_utc
        data_type: timestamp_tz
      - name: date_deleted
        data_type: boolean

  - name: stg_sql_server_dbo__order_items
    description: order items details
    config:
      contract:
        enforced: true
    constraints:
      - type: primary_key
        columns: [order_id, product_id]
    columns:
      - name: order_id
        data_type: text
        data_tests:
          - relationships:
              field: order_id
              to: ref('stg_sql_server_dbo__orders')
        constraints:
          - type: foreign_key
            to: ref('stg_sql_server_dbo__orders')
            to_columns: [order_id]
      - name: product_id
        data_type: text
        data_tests:
          - relationships:
              field: product_id
              to: ref('stg_sql_server_dbo__products')
        constraints:
          - type: foreign_key
            to: ref('stg_sql_server_dbo__products')
            to_columns: [product_id]              
      - name: quantity
        data_type: integer
      - name: date_load_utc
        data_type: timestamp_tz
      - name: date_deleted
        data_type: boolean

  - name: stg_sql_server_dbo__events
    description: events info
    config:
      contract:
        enforced: true
    constraints:
      - type: primary_key
        columns: [event_id, session_id]
    columns:
      - name: event_id
        data_type: text
      - name: page_url
        data_type: text
      - name: event_type
        data_type: text
        data_tests:
          - accepted_values:
              values: ['package_shipped','add_to_cart','checkout','page_view'] # poner en otra tabla
      - name: user_id
        data_type: text   
        data_tests:
          - relationships:
              field: user_id
              to: ref('stg_sql_server_dbo__users')
        constraints:
          - type: foreign_key
            to: ref('stg_sql_server_dbo__users')
            to_columns: [user_id]     
      - name: product_id # tiene nulos
        # data_tests:
        #   - relationships:
        #       field: product_id
        #       to: ref('stg_sql_server_dbo__products')
        # constraints:
        #   - type: foreign_key
        #     to: ref('stg_sql_server_dbo__products')
        #     to_columns: [product_id]     
        data_type: text      
      - name: session_id
        data_type: text
      - name: created_at
        data_type: timestamp_tz
      - name: order_id # tiene nulos
        data_type: text
      - name: date_load_utc
        data_type: timestamp_tz
      - name: date_deleted
        data_type: boolean